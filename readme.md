### 《五行生态》游戏需求设计文档

#### 1. **项目概述**
**游戏名称**：五行生态（Wuxing World，暂定）  
**类型**：2D开放沙盒（核心），结合策略模拟、解谜、生存冒险  
**平台**：PC（基于Love2D引擎，Lua语言）  
**目标**：基于中国五行哲学（金、木、水、火、土），打造一个动态演化的自然世界，玩家通过放置/破坏tile影响生态循环，体验资源管理、环境改造、解谜和生存挑战。游戏采用Entity-Component-System（ECS）架构，确保模块化、扩展性和性能，支持动态添加对象及其状态变化。  
**灵感**：Minecraft（沙盒自由）、Noita（动态环境）、Monkey King: Five Elements Survival（五行解谜）、Dwarf Fortress（生态模拟）。  
**核心愿景**：创造一个“活”的世界，tile和移动对象通过五行相生相克规则演化，涌现自然生态循环，玩家可自由干预，感受哲学与策略乐趣。

#### 2. **核心机制**
游戏以五行属性为核心，tile（网格方块，如小树、河流）和移动对象（动物、玩家）携带五行向量（[metal, wood, water, fire, earth]），通过相生（木生火、火生土、土生金、金生水、水生木）和相克（金克木、木克土、土克水、水克火、火克金）规则驱动动态演化，触发状态/形态变化。

##### 2.1 **Tile系统**
- **世界网格**：2D网格（初始20x20，可扩展至100x100），每个格子为一个tile，代表环境元素（例如，小树、水、土壤）。
- **五行向量**：每个tile有五行属性向量（值0-1，初始根据类型分配），示例：
  - 小树：[0, 0.7, 0.2, 0, 0.1]（偏木，需水和土）。
  - 河流：[0, 0, 1, 0, 0]（纯水）。
  - 土壤：[0, 0, 0, 0, 1]（纯土）。
  - 熔岩：[0, 0, 0, 1, 0]（纯火）。
  - 矿石：[0.8, 0, 0, 0, 0.2]（偏金）。
- **状态/形态变化**：五行值超出阈值时，tile切换形态，示例：
  - 小树（木>0.5，水>0.2）→大树（木>0.7，水>0.3）→枯树（水<0.1）→着火的树（火>0.3）→灰烬（土>0.5，木<0.1）。
- **交互**：tile检查8邻居（Moore邻域），更新五行向量：
  - **相生**：邻居增强“被生”属性（水tile增小树tile的木属性，水生木）。
  - **相克**：邻居削弱“被克”属性（火tile减小树tile的木属性，火克木）。
  - **随机性**：属性变化加扰动（±0.01），模拟自然不确定性。

##### 2.2 **移动对象（动物、玩家）**
- **定义**：动物（如兔子）和玩家为移动实体，携带五行向量，示例：
  - 兔子：[0, 0.6, 0.3, 0, 0.1]（偏木，需水）。
  - 玩家：[0.2, 0.2, 0.2, 0.2, 0.2]（平衡，适应性强）。
- **状态变化**：根据五行值切换状态，示例：
  - 兔子：健康（木>0.5，水>0.3）→饥渴（水<0.2）→受伤（火>0.3）→死亡（木<0.1）。
- **交互**：
  - 动物检查所在tile和邻居，更新五行向量，决定行为：
    - 高木（草地）：停留吃草（木+0.1）。
    - 高火（火灾）：逃离（向低火tile移动）。
    - 高水（河流）：饮水（水+0.1）。
  - 动物影响环境：兔子吃草减tile木属性，可能变土tile（过牧）。

##### 2.3 **涌现效果**
- **生态循环**：局部五行交互（tile与邻居、动物与环境）形成全局循环：
  - 木tile（森林）被火tile吞噬，变灰烬（土tile），水tile滋养后再生木tile，模拟火灾-植被再生。
  - 动物随环境迁移（避火、亲水），形成动态生态群落。
- **随机事件**：
  - 雷击：生成火tile，触发火灾。
  - 降雨：临时水tile或全局水属性+0.1，促进植被。
- **玩家干预**：放置/破坏tile触发连锁反应（水tile扑灭火tile，促木tile生长）。

##### 2.4 **动态添加对象**
- **目标**：运行时添加新tile（如“泥”=[0, 0.2, 0.6, 0, 0.2]）或动物（如“鸟”），支持自定义状态（例如，湿泥→干泥）。
- **实现**：
  - 新对象通过配置文件（JSON/Lua表）定义五行向量、状态阈值、贴图。
  - 例如，“泥”tile模板：{type=“mud”, five_elements={0, 0.2, 0.6, 0, 0.2}, states=[{name=“wet_mud”, condition={water>0.5}, sprite=“wet_mud.png”}, {name=“dry_mud”, condition={water<0.2, earth>0.6}, sprite=“dry_mud.png”}]}。
  - ECS系统自动处理新对象的五行交互和状态切换。

#### 3. **游戏类型与玩法**
**主要类型**：开放沙盒（核心），结合策略模拟、解谜、生存冒险。  
**玩法目标**：
- **沙盒自由**：探索、改造动态世界，放置/破坏tile影响生态。
- **策略管理**：平衡五行，管理资源，防止生态崩溃。
- **解谜挑战**：通过tile放置解决任务（如荒地变森林）。
- **生存冒险**：应对环境威胁（火灾、洪水），收集资源。

**具体玩法**：
- **生态改造**：
  - 放置水tile滋养木tile，恢复森林；用土tile（土克水）堵洪水。
  - 破坏木tile获木材，可能导致土tile扩张（沙漠化）。
- **资源系统**：
  - Tile掉落：大树（更多木材）、灰烬（肥料）、金tile（金属）。
  - 动物掉落：兔子死亡产皮革，受五行状态影响。
- **动物交互**：
  - 引导动物迁移（水tile吸引兔子）。
  - 动物行为随五行变化（避火、亲水）。
- **任务/挑战**：
  - 解谜：将土tile区变森林，需水tile触发水生木。
  - 生存：阻止火tile烧毁基地，用水tile或土tile防御。
  - 探索：发现金tile矿区，观察生态循环。
- **随机事件**：
  - 雷击（火tile）引发火灾。
  - 降雨（水tile）促植被再生。

#### 4. **技术实现**
**引擎**：Love2D 11.4+（支持SpriteBatch、ParticleSystem）。  
**架构**：Entity-Component-System（ECS），推荐Tiny-ECS或自写轻量ECS。  
**代码组织**：
- **main.lua**：初始化ECS世界、网格、玩家，调用love.update/draw。
- **ecs/**：
  - **components.lua**：
    - **Position**：坐标（tile：网格x,y；动物：像素x,y）。
    - **FiveElements**：五行向量（[metal, wood, water, fire, earth]）。
    - **State**：形态/状态（例如，“sapling”、“healthy”）。
    - **Renderable**：贴图/动画（例如，“assets/green_sapling.png”）。
    - **Movable**：动物/玩家移动（速度、目标）。
  - **systems.lua**：
    - **FiveElementsSystem**：更新五行向量，基于邻居相生相克（系数0.05，扰动±0.01）。
    - **StateSystem**：检查五行阈值，切换状态（例如，木>0.7变“大树”）。
    - **MovementSystem**：动物根据五行移动（避火>0.3，亲水>0.2）。
    - **RenderSystem**：绘制tilemap（SpriteBatch）和动物（Sprite）。
    - **InputSystem**：处理玩家输入（放置/破坏tile）。
  - **entity_manager.lua**：管理实体创建/查询，解析JSON模板添加新对象。
- **game/**：
  - **world.lua**：2D网格（tilemap），用Perlin噪声初始化五行分布。
  - **tiles.lua**：定义tile类型（小树、大树等）及其五行向量/阈值。
  - **agents.lua**：定义动物/玩家行为（兔子吃草、避火）。
- **assets/**：贴图（green_sapling.png、burning_tree.png）、粒子效果。

**动态添加实现**：
- **配置文件**：JSON/Lua表定义新tile/动物（五行向量、状态阈值、贴图）。
- **加载**：entity_manager解析模板，创建实体，分配组件（love.graphics.newImage加载Sprite）。
- **处理**：FiveElementsSystem、StateSystem自动处理新对象的交互和状态切换。

**技术细节**：
- **Tilemap**：SpriteBatch渲染网格，State组件决定贴图。
- **更新**：love.update(dt)运行ECS系统，只更新活跃区域（玩家附近，存Set/QuadTree）。
- **交互**：
  - Tile：检查8邻居，更新五行向量（相生/相克）。
  - 动物：检查所在/邻近tile，更新五行，决定行为。
  - 玩家：love.mousepressed处理放置/破坏tile，触发FiveElementsSystem。
- **可视化**：
  - Tile：小树（绿色小苗）、着火的树（ParticleSystem火焰）。
  - 动物：健康兔子（活泼动画）、受伤（红色闪烁）。
  - UI：悬浮窗显示五行值（love.graphics.print）。
- **性能优化**：
  - 活跃区域更新（玩家附近10x10网格）。
  - QuadTree优化邻居查询。
  - SpriteBatch批量渲染。

#### 5. **玩家体验**
- **沉浸感**：动态生态（木→火→土→水→木）模拟火灾-植被再生，世界“活”起来。
- **策略性**：
  - 平衡五行：用水tile扑灭火tile，防洪用土tile。
  - 资源管理：采集木材（木tile）、肥料（灰烬）、金属（金tile）。
- **探索乐趣**：随机事件（雷击、降雨）和五行交互形成不可预测模式（火灾、矿脉生成）。
- **解谜挑战**：任务要求调整五行（荒地变绿地）。
- **生存压力**：应对火灾/洪水，保护基地。
- **文化深度**：五行哲学融入玩法，玩家感受自然和谐。
- **动态扩展**：玩家/模组作者添加新tile（如“泥”）、动物（如“鸟”），丰富生态。

#### 6. **开发要求**
- **团队角色**：
  - 程序员：实现ECS、tilemap、五行规则、性能优化。
  - 美术：设计tile/动物贴图（小树、兔子等），火焰/生长粒子效果。
  - 设计师：平衡五行系数（0.05）、阈值（木>0.7变大树），设计任务。
  - 测试：验证生态循环、玩家交互、动态添加。
- **技术需求**：
  - Love2D 11.4+。
  - Tiny-ECS或自写ECS。
  - 工具：Tiled（地图编辑）、Aseprite（贴图）。
- **测试重点**：
  - 平衡：防止火tile过快扩散或生态僵化。
  - 交互：玩家放置tile触发预期连锁反应。
  - 动态添加：新tile/动物无缝融入。
  - 视觉：状态变化平滑（小树→大树）。

#### 7. **扩展功能**
- **多人模式**：玩家协作/竞争控制生态（一方点火，一方救火）。
- **新对象**：tile（泥、岩石）、动物（鸟、狼）。
- **季节系统**：周期性调整五行影响（夏季火强，春季水强）。
- **模组支持**：API允许玩家上传JSON模板和贴图。
- **农业系统**：五行影响作物（水tile促木属性作物生长）。
- **RPG元素**：玩家/动物技能基于五行（水属性技能克火）。

#### 8. **风险与挑战**
- **性能**：大地图更新需优化（活跃区域、QuadTree）。
- **复杂性**：五行规则需清晰UI/教程（显示五行值，解释“水克火”）。
- **平衡**：调整相生/相克系数，防止生态崩溃或单调。
- **美术**：动态添加需玩家提供贴图，或默认占位贴图。
- **动态添加**：配置文件需规范化，防止状态冲突。

#### 9. **开发计划**
- **阶段1（原型，4周）**：
  - ECS框架、20x20 tilemap、五行规则。
  - 基本tile（小树、大树、枯树、着火的树、灰烬、水、土、金）。
  - 1种动物（兔子，健康/受伤）。
  - 玩家交互：放置/破坏tile。
- **阶段2（核心玩法，6周）**：
  - 随机事件（雷击、降雨）。
  - 资源系统（木材、肥料、金属）。
  - 任务：生态改造（荒地变森林）。
  - 动态添加：JSON模板加载新tile。
  - 性能优化（活跃区域）。
- **阶段3（打磨，4周）**：
  - 美术：贴图、粒子效果（火焰、生长）。
  - UI：五行值显示。
  - 测试平衡性和引导。
- **阶段4（扩展，4周）**：
  - 新tile/动物。
  - 多人模式或季节系统.
  - 模组API。

#### 10. **目标玩家群体**
- 沙盒爱好者（Minecraft、Terraria）。
- 策略/模拟玩家（SimCity、Dwarf Fortress）。
- 解谜爱好者（The Witness）。
- 中国文化/哲学爱好者（五行、自然和谐）。
- 动态环境玩家（Noita）。

#### 11. **架构选择：ECS**
- **理由**：
  - **模块化**：新tile/动物只需组件组合（FiveElements、State），支持动态添加。
  - **性能**：批量处理组件，适合大地图（100x100）和动物群。
  - **逻辑清晰**：五行规则（FiveElementsSystem）、状态变化（StateSystem）、动物行为（MovementSystem）分离。
  - **动态性**：JSON模板加载新对象，StateSystem处理自定义状态阈值。
- **替代方案**：
  - OOP：适合小规模原型，扩展性差。
  - 非ECS组件：中等规模折中，性能不如ECS。
- **实现**：
  - Tiny-ECS或自写ECS（实体为ID表，组件为Lua表，系统为函数）。
  - Love2D SpriteBatch渲染tilemap，ParticleSystem动态效果。

---

### 总结
《五行生态》通过ECS架构实现动态五行世界，tile和动物基于五行向量演化，涌现生态循环（火灾-再生）。玩家放置/破坏tile参与资源管理、解谜、生存，动态添加新对象（tile/动物）及其状态增强沙盒自由度。ECS确保模块化、性能和扩展性，Love2D支持高效渲染和交互。开发优先实现原型（五行规则、状态变化），逐步扩展玩法和模组支持。如果需要详细代码结构或某模块设计（如JSON解析器），可进一步提供！



现在我需要用代码验证五行驱动的游戏,具体要求如下

1. 符号表示不同属性
  木 ： ▲ 或者 ^（向上生长，三角形/箭头向上）
  火 ： ✦ 或者 *（星芒/火焰形）
  土 ： ■ 或者 #（方形，稳定）
  金 ： ○ 或者 o（圆形，收敛、坚硬）
  水 ： ∇或者 v（波浪/倒三角，向下流动）

2. 符号表示相生相克 (→相生, ×相克)
  相生顺序：▲→✦→■→○→∇→▲
  相克顺序: ▲×■×∇×✦×○×▲

4. 或者用表情符号
  元素,意象符号,相生图像（→）,相克图像（X）
  木,🌳（树）,水~ → 🌳（河水浇树）,🌳 X ■（树根裂土）
  火,🔥（焰）,🌳 → 🔥（树枝点火）,🔥 X ○（火熔金属球）
  土,🏔（山）,🔥 → 🏔（火山灰成土）,🏔 X ~（土坝堵水）
  金,⚔️（剑）,🏔 → ⚔️（山矿炼剑）,⚔️ X 🌳（剑砍树）
  水,🌊（浪）,⚔️ → 🌊（剑上凝水珠）,🌊 X 🔥（浪灭火）

  5. 类似元胞机的模拟过程
  屏幕显示长宽为n的正方形区域,n可以配置
  正方形区域里随机放置金木水火土的符号
  每个符号根据周围邻居的属性决定怎么变化
  运损频率可以配置

  用love2d 和 lua 设计一个这样的程序,越简单越好,但是要实现元胞机的过程